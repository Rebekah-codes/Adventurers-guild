<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Animated Scroll — Adventurers Guild</title>
  <link rel="stylesheet" href="/scroll2.css" />
  <style>
    /* Overrides to ensure the paper text shows as plain black text with no grey boxes */
    .overlay .paper-text,
    .overlay .paper-text *,
    .overlay .paper-text p,
    .overlay .paper-text p::before,
    .overlay .paper-text p::after,
    .overlay .paper-text div,
    .overlay .paper-text span {
      background: transparent !important;
      background-color: transparent !important;
      box-shadow: none !important;
      border: none !important;
      color: #000 !important;
      padding: 0 !important;
      margin: 0 !important;
      border-radius: 0 !important;
    }

    /* Typewriter styles */
    .scroll-typewriter {
      display: inline-block;
      font-family: Uncial Antiqua, serif, monospace;
      font-size: 1rem;
      white-space: pre-wrap; /* allow line breaks to wrap */
      overflow: hidden;
      --characters: 60;
      --duration: 3500ms;
      color: #000;
      background: transparent;
      padding: 0;
      margin: 0;
    }

    .scroll-typewriter .text {
      display: inline-block;
      max-width: 0;
      vertical-align: top;
      animation: typing var(--duration) steps(var(--characters)) forwards;
      white-space: pre-wrap;
    }

    .scroll-typewriter .caret {
      display: inline-block;
      margin-left: .25rem;
      animation: blink 1s steps(1) infinite;
    }

    @keyframes typing { to { max-width: calc(var(--characters) * 1ch); } }
    @keyframes blink { 0%,50% { opacity: 1; } 51%,100% { opacity: 0; } }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="scroll-container" aria-label="Animated scroll">
      <!-- SVG scroll: two rollers and a central paper that scales from 0->1 in Y -->
      <svg class="scroll-svg" viewBox="0 0 800 360" preserveAspectRatio="xMidYMid meet" role="img" aria-hidden="false">
        <defs>
          <filter id="grain"><feTurbulence baseFrequency="0.9" numOctaves="2" stitchTiles="stitch" result="noise"/><feColorMatrix type="saturate" values="0" in="noise" result="mono"/><feBlend in="SourceGraphic" in2="mono" mode="overlay"/></filter>
          <!-- paper pattern for subtle texture -->
          <pattern id="paperPattern" patternUnits="userSpaceOnUse" width="800" height="400">
            <rect width="100%" height="100%" fill="#f7efe0" />
            <filter id="tex"><feTurbulence baseFrequency="0.6" numOctaves="2" stitchTiles="stitch" result="t"/><feColorMatrix type="saturate" values="0" in="t" result="m"/><feBlend in="SourceGraphic" in2="m" mode="overlay"/></filter>
            <rect width="100%" height="100%" fill="rgba(0,0,0,0)" filter="url(#tex)" opacity="0.06" />
          </pattern>
          <clipPath id="paperClip"><rect x="110" y="40" width="580" height="280" rx="12" ry="12"/></clipPath>
        </defs>

        <!-- left roller -->
        <g class="roller left">
          <rect x="60" y="40" width="40" height="280" rx="10" ry="10" fill="#2b1830" opacity="0.9"/>
          <circle cx="80" cy="180" r="18" fill="#401a5a"/>
        </g>

        <!-- right roller -->
        <g class="roller right">
          <rect x="700" y="40" width="40" height="280" rx="10" ry="10" fill="#2b1830" opacity="0.9"/>
          <circle cx="720" cy="180" r="18" fill="#401a5a"/>
        </g>

        <!-- the paper area that will 'unfurl' using a scale transform on a group -->
        <g class="paper-wrap" clip-path="url(#paperClip)">
          <rect class="paper" x="110" y="40" width="580" height="280" rx="12" ry="12" fill="url(#paperPattern)" stroke="#e7dcc6" stroke-width="1.5"/>
          <!-- stronger subtle texture overlay -->
          <rect x="110" y="40" width="580" height="280" rx="12" ry="12" fill="rgba(0,0,0,0)" filter="url(#grain)" opacity="0.08" />
        </g>

        <!-- overlay placeholder for text and sigil. They will be positioned with CSS using absolute overlay too -->
      </svg>

      <div class="overlay">
        <div class="sigil">
          <svg viewBox="0 0 100 100" width="92" height="92" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <circle cx="50" cy="50" r="46" fill="#2b1830"/>
            <text x="50%" y="55%" text-anchor="middle" fill="#f5e6c8" font-family="Uncial Antiqua, serif" font-size="28">AG</text>
          </svg>
        </div>

        <div class="paper-text">
          <h2>Welcome, traveler</h2>
          <div class="scroll-typewriter" id="scroll2-typewriter">
            <span class="text" id="scroll2-text">To the brave soul whose name now graces our ledger,

By decree of the Guildmaster and the Circle of Blades, you are hereby welcomed into the Adventurers Guild of Asharavel. From the moss-laced ruins of Eldenmere to the frostbitten peaks of Tharundel, our banners fly where corruption festers and now, yours shall fly among them.

You are no longer wanderer, nor mercenary, nor lone blade in the dark. You are kin to elves, dwarves, humans, and all who stand against the shadow. Your oath binds you to the defense of the realm, the pursuit of honor, and the cleansing of evil in all its forms, be it goblin horde, spider brood, or troll siege.

Within these halls you shall find comrades, quests, and chronicles. Your deeds will be etched into the Guild’s log, your victories sung in the taverns of Silverfen, and your failures, should they come, be met with steel and solidarity.

Take up your sigil. Ready your blade. The world awaits.

Signed in ink and flame,
Guildmaster of Asharavel</span><span class="caret">|</span>
          </div>
        </div>
      </div>

      <div class="controls">
        <button id="playScroll">Unfurl Scroll</button>
      </div>
    </section>
  </main>
  <script src="/scroll2.js"></script>
  <script>
    (function() {
      const el = document.getElementById('scroll2-text');
      const container = document.getElementById('scroll2-typewriter');
      if (!el || !container) return;
      const text = (el.textContent || '').trim();
      // pick duration proportional to length, but at least 3.5s
      const durationMs = Math.max(3500, text.length * 40);
      container.style.setProperty('--characters', String(text.length));
      container.style.setProperty('--duration', `${durationMs}ms`);

      // Loop: restart animation after it finishes (with small pause)
      const pause = 800;
      setInterval(() => {
        el.style.animation = 'none';
        void el.offsetWidth; // reflow
        el.style.animation = `typing ${container.style.getPropertyValue('--duration') || durationMs + 'ms'} steps(${text.length}) forwards`;
      }, durationMs + pause);
    })();
  </script>
</body>
</html>
